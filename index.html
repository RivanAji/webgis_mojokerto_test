<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <title>Geoportal Kabupaten Mojokerto - Beta</title>

        <link rel="stylesheet" href="css/leaflet.css">
        <!-- <link rel="stylesheet" href="css/L.Control.Layers.Tree.css"> -->
        <link rel="stylesheet" href="css/L.Control.Locate.min.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <!-- <link rel="stylesheet" href="css/L.Control.AccordionLegend.css"> -->
        <style>
            body, html {
                padding: 0;
                margin: 0;
                width: 100%;
                height: 100%;
                font-family: 'Noto Sans', sans-serif;
            }
            header {
                background: #f2f2f2;
                padding: 10px 20px;
                box-shadow: 0 0 5px rgba(0,0,0,0.2);
                position: fixed;
                top: 0;
                width: 100%;
                z-index: 1000;
                box-sizing: border-box;    
            }
            header h1 {
                margin: 0;
                font-size: 1.3em;
            }
            header p {
                margin: 5px 0 0;
                color: #666;
            }
            #container {
                display: flex; /* agar legend dan map sejajar ke samping */
                margin-top: 70px; 
                height: calc(100% - 70px); /* sisakan ruang untuk header */
            }
            #map {
                flex: 1; /* sisanya untuk peta */
                height: 100%;
            }
            .my-legend-control {
                position: relative; 
                padding: 10px;
                background: white;
                color: #333;
                border: 1px solid #ccc;
                border-radius: 4px;
                width: 200px;      /* atur lebar sesuai kebutuhan */
                font-size: 14px;
                line-height: 1.4em;
            }
            .my-legend-control h4 {
                margin: 0 0 8px 0;
                font-size: 16px;
            }
            .legend-item {
                margin-bottom: 6px;
            }
            .legend-item img {
                vertical-align: middle;
                margin-right: 4px;
            }
        </style>
    </head>
    <body>
        <!-- 1) HEADER WEBGIS -->
        <header>
            <h1>Geoportal Kabupaten Mojokerto - Beta</h1>
            <p>Preview lokasi Kecamatan Mojosari</p>
        </header>

        <div id="container">
            <div id="map">
            </div>
        </div>
    <!-- DIV untuk MAP -->
        <div id="map">
        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <!-- <script src="js/L.Control.Layers.Tree.min.js"></script> -->
        <script src="js/L.Control.Locate.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <!-- <script src="js/L.Control.AccordionLegend.js"></script> -->
        <script src="data/BatasAdministrasi_1.js"></script>
        <script src="data/Bangunan_2.js"></script>
        <script src="data/BlokMojosari_3.js"></script>
        <script src="data/Jalan_4.js"></script>
        <script src="data/FotoGeotag_5.js"></script>
        <script>
        var highlightLayer;
        function highlightFeature(e) {
            highlightLayer = e.target;

            if (e.target.feature.geometry.type === 'LineString' || e.target.feature.geometry.type === 'MultiLineString') {
              highlightLayer.setStyle({
                color: '#ffff00',
              });
            } else {
              highlightLayer.setStyle({
                fillColor: '#ffff00',
                fillOpacity: 1
              });
            }
            highlightLayer.openPopup();
        }
        var map = L.map('map', {
            zoomControl:false, maxZoom:18, minZoom:15
        }).fitBounds([[-7.491529021191738,112.53099004832993],[-7.462931846798375,112.55839180866998]]);
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        L.control.locate({locateOptions: {maxZoom: 19}}).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
        }
        map.createPane('pane_GoogleSatellite_0');
        map.getPane('pane_GoogleSatellite_0').style.zIndex = 400;
        var layer_GoogleSatellite_0 = L.tileLayer('https://mt1.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
            pane: 'pane_GoogleSatellite_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 30
        });
        layer_GoogleSatellite_0;
        map.createPane('pane_OpenStreetMap_1');
        map.getPane('pane_OpenStreetMap_1').style.zIndex = 401;
        var layer_OpenStreetMap_1 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_1',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        map.createPane('pane_CartoDBPositronNoLabels_0');
        map.getPane('pane_CartoDBPositronNoLabels_0').style.zIndex = 400;
        var layer_CartoDBPositronNoLabels_0 = L.tileLayer('https://a.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
            pane: 'pane_CartoDBPositronNoLabels_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 30
        });
        layer_CartoDBPositronNoLabels_0;
        // map.addLayer(layer_CartoDBPositronNoLabels_0);
        function pop_BatasAdministrasi_1(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKK'] !== null ? autolinker.link(String(feature.properties['WADMKK']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMPR'] !== null ? autolinker.link(String(feature.properties['WADMPR']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_BatasAdministrasi_1_0() {
            return {
                pane: 'pane_BatasAdministrasi_1',
                opacity: 1,
                color: 'rgba(224,1,84,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,253,253,0.0)',
                interactive: false,
            }
        }
        map.createPane('pane_BatasAdministrasi_1');
        map.getPane('pane_BatasAdministrasi_1').style.zIndex = 401;
        map.getPane('pane_BatasAdministrasi_1').style['mix-blend-mode'] = 'normal';
        var layer_BatasAdministrasi_1 = new L.geoJson(json_BatasAdministrasi_1, {
            attribution: '',
            interactive: false,
            dataVar: 'json_BatasAdministrasi_1',
            layerName: 'layer_BatasAdministrasi_1',
            pane: 'pane_BatasAdministrasi_1',
            onEachFeature: pop_BatasAdministrasi_1,
            style: style_BatasAdministrasi_1_0,
        });
        bounds_group.addLayer(layer_BatasAdministrasi_1);
        map.addLayer(layer_BatasAdministrasi_1);
        function pop_Bangunan_2(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['id'] !== null ? autolinker.link(String(feature.properties['id']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['area_in_me'] !== null ? autolinker.link(String(feature.properties['area_in_me']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['confidence'] !== null ? autolinker.link(String(feature.properties['confidence']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['full_plus_'] !== null ? autolinker.link(String(feature.properties['full_plus_']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['longitude_'] !== null ? autolinker.link(String(feature.properties['longitude_']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Bangunan_2_0() {
            return {
                pane: 'pane_Bangunan_2',
                opacity: 1,
                color: 'rgba(169,169,169,0.505)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1, 
                fillOpacity: 0,
                interactive: true,
            }
        }
        map.createPane('pane_Bangunan_2');
        map.getPane('pane_Bangunan_2').style.zIndex = 402;
        map.getPane('pane_Bangunan_2').style['mix-blend-mode'] = 'normal';
        var layer_Bangunan_2 = new L.geoJson(json_Bangunan_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_Bangunan_2',
            layerName: 'layer_Bangunan_2',
            pane: 'pane_Bangunan_2',
            onEachFeature: pop_Bangunan_2,
            style: style_Bangunan_2_0,
        });
        bounds_group.addLayer(layer_Bangunan_2);
        map.addLayer(layer_Bangunan_2);
        function pop_BlokMojosari_3(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">Blok</th>\
                        <td>' + (feature.properties['Blok'] !== null ? autolinker.link(String(feature.properties['Blok']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Alamat</th>\
                        <td>' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">GSB_M</th>\
                        <td>' + (feature.properties['GSB_M'] !== null ? autolinker.link(String(feature.properties['GSB_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">KDB_Persen</th>\
                        <td>' + (feature.properties['KDB_Persen'] !== null ? autolinker.link(String(feature.properties['KDB_Persen']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">KDH_Persen</th>\
                        <td>' + (feature.properties['KDH_Persen'] !== null ? autolinker.link(String(feature.properties['KDH_Persen']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">KLB</th>\
                        <td>' + (feature.properties['KLB'] !== null ? autolinker.link(String(feature.properties['KLB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">KTB</th>\
                        <td>' + (feature.properties['KTB'] !== null ? autolinker.link(String(feature.properties['KTB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">TLB_M</th>\
                        <td>' + (feature.properties['TLB_M'] !== null ? autolinker.link(String(feature.properties['TLB_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">JLB</th>\
                        <td>' + (feature.properties['JLB'] !== null ? autolinker.link(String(feature.properties['JLB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Luas_M</th>\
                        <td>' + (feature.properties['Luas_M'] !== null ? autolinker.link(String(feature.properties['Luas_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_BlokMojosari_3_0() {
            return {
                pane: 'pane_BlokMojosari_3',
                opacity: 1,
                color: 'rgba(255,125,0,0.5)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,174,13,0.5)',
                interactive: true,
            }
        }
        map.createPane('pane_BlokMojosari_3');
        map.getPane('pane_BlokMojosari_3').style.zIndex = 403;
        map.getPane('pane_BlokMojosari_3').style['mix-blend-mode'] = 'normal';
        var layer_BlokMojosari_3 = new L.geoJson(json_BlokMojosari_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_BlokMojosari_3',
            layerName: 'layer_BlokMojosari_3',
            pane: 'pane_BlokMojosari_3',
            onEachFeature: pop_BlokMojosari_3,
            style: style_BlokMojosari_3_0,
        });
        bounds_group.addLayer(layer_BlokMojosari_3);
        map.addLayer(layer_BlokMojosari_3);
        function pop_Jalan_4(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['FID_BLOK_M'] !== null ? autolinker.link(String(feature.properties['FID_BLOK_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['REMARK'] !== null ? autolinker.link(String(feature.properties['REMARK']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKD'] !== null ? autolinker.link(String(feature.properties['WADMKD']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKC'] !== null ? autolinker.link(String(feature.properties['WADMKC']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMKK'] !== null ? autolinker.link(String(feature.properties['WADMKK']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['WADMPR'] !== null ? autolinker.link(String(feature.properties['WADMPR']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Ruas'] !== null ? autolinker.link(String(feature.properties['Ruas']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Blok'] !== null ? autolinker.link(String(feature.properties['Blok']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Alamat'] !== null ? autolinker.link(String(feature.properties['Alamat']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['GSB_M'] !== null ? autolinker.link(String(feature.properties['GSB_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KDB_Persen'] !== null ? autolinker.link(String(feature.properties['KDB_Persen']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KDH_Persen'] !== null ? autolinker.link(String(feature.properties['KDH_Persen']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KLB'] !== null ? autolinker.link(String(feature.properties['KLB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['KTB'] !== null ? autolinker.link(String(feature.properties['KTB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['TLB_M'] !== null ? autolinker.link(String(feature.properties['TLB_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['JLB'] !== null ? autolinker.link(String(feature.properties['JLB']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Luas_M'] !== null ? autolinker.link(String(feature.properties['Luas_M']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Status'] !== null ? autolinker.link(String(feature.properties['Status']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['FID_JarJal'] !== null ? autolinker.link(String(feature.properties['FID_JarJal']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Id'] !== null ? autolinker.link(String(feature.properties['Id']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Shape_Leng'] !== null ? autolinker.link(String(feature.properties['Shape_Leng']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['Shape_Area'] !== null ? autolinker.link(String(feature.properties['Shape_Area']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_Jalan_4_0() {
            return {
                pane: 'pane_Jalan_4',
                stroke: false, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(19,21,23,1.0)',
                interactive: false,
            }
        }
        map.createPane('pane_Jalan_4');
        map.getPane('pane_Jalan_4').style.zIndex = 404;
        map.getPane('pane_Jalan_4').style['mix-blend-mode'] = 'normal';
        var layer_Jalan_4 = new L.geoJson(json_Jalan_4, {
            attribution: '',
            interactive: false,
            dataVar: 'json_Jalan_4',
            layerName: 'layer_Jalan_4',
            pane: 'pane_Jalan_4',
            onEachFeature: pop_Jalan_4,
            style: style_Jalan_4_0,
        });
        bounds_group.addLayer(layer_Jalan_4);
        map.addLayer(layer_Jalan_4);
        function pop_FotoGeotag_5(feature, layer) {
            layer.on({
                mouseout: function(e) {
                    for (var i in e.target._eventParents) {
                        if (typeof e.target._eventParents[i].resetStyle === 'function') {
                            e.target._eventParents[i].resetStyle(e.target);
                        }
                    }
                    if (typeof layer.closePopup == 'function') {
                        layer.closePopup();
                    } else {
                        layer.eachLayer(function(feature){
                            feature.closePopup()
                        });
                    }
                },
                mouseover: highlightFeature,
            });
            var popupContent = '<table>\
                    <tr>\
                        <th scope="row">photo</th>\
                        <td>' + (feature.properties['photo'] !== null ? '<img src="images/' + String(feature.properties['photo']).replace(/[\\\/:]/g, '_').trim().replace(/'/g, '\\\'').replace(/\"/g, '&quot;') + '">' : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">filename</th>\
                        <td>' + (feature.properties['filename'] !== null ? autolinker.link(String(feature.properties['filename']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">longitude</th>\
                        <td>' + (feature.properties['longitude'] !== null ? autolinker.link(String(feature.properties['longitude']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">latitude</th>\
                        <td>' + (feature.properties['latitude'] !== null ? autolinker.link(String(feature.properties['latitude']).replace(/'/g, '\'').replace(/"/g, '&quot;').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_FotoGeotag_5_0() {
            return {
                pane: 'pane_FotoGeotag_5',
                radius: 6.0,
                opacity: 1,
                color: 'rgba(50,87,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 3.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(72,123,182,1.0)',
                interactive: true,
            }
        }
        map.createPane('pane_FotoGeotag_5');
        map.getPane('pane_FotoGeotag_5').style.zIndex = 405;
        map.getPane('pane_FotoGeotag_5').style['mix-blend-mode'] = 'normal';
        var layer_FotoGeotag_5 = new L.geoJson(json_FotoGeotag_5, {
            attribution: '',
            interactive: true,
            dataVar: 'json_FotoGeotag_5',
            layerName: 'layer_FotoGeotag_5',
            pane: 'pane_FotoGeotag_5',
            onEachFeature: pop_FotoGeotag_5,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_FotoGeotag_5_0(feature));
            },
        });
        bounds_group.addLayer(layer_FotoGeotag_5);
        map.addLayer(layer_FotoGeotag_5);
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .title += 'Search for a place';

        function setBasemap(basemap) {
            // Matikan semua basemap dulu
            map.removeLayer(layer_CartoDBPositronNoLabels_0);
            map.removeLayer(layer_OpenStreetMap_1);
            map.removeLayer(layer_GoogleSatellite_0);

            // Nyalakan layer basemap sesuai pilihan
            if (basemap === 'carto') {
                map.addLayer(layer_CartoDBPositronNoLabels_0);
            } else if (basemap === 'osm') {
                map.addLayer(layer_OpenStreetMap_1);
            } else if (basemap === 'google') {
                map.addLayer(layer_GoogleSatellite_0);
            }
        }
        var customLegend = L.control({ position: 'topright' });
        customLegend.onAdd = function(map) {
            var div = L.DomUtil.create('div', 'my-legend-control');
            div.innerHTML = `
                <h4>Legenda</h4>
                <div class="legend-item">
                    <input type="checkbox" id="chk_fotogeotag" checked />
                    <label for="chk_fotogeotag">
                    <img src="legend/FotoGeotag_5.png" alt="FotoGeotag" width="20">
                    Foto Geotag
                    </label>
                </div>

                <div class="legend-item">
                    <input type="checkbox" id="chk_jalan" checked />
                    <label for="chk_jalan">
                    <img src="legend/Jalan_4.png" alt="Jalan" width="20">
                    Jalan
                    </label>
                </div>

                <div class="legend-item">
                    <input type="checkbox" id="chk_blok" checked />
                    <label for="chk_blok">
                    <img src="legend/BlokMojosari_3.png" alt="Blok Mojosari" width="20">
                    Blok Mojosari
                    </label>
                </div>

                <div class="legend-item">
                    <input type="checkbox" id="chk_bangunan" checked />
                    <label for="chk_bangunan">
                    <img src="legend/Bangunan_2.png" alt="Bangunan" width="20">
                    Bangunan
                    </label>
                </div>

                <div class="legend-item">
                    <input type="checkbox" id="chk_batas" checked />
                    <label for="chk_batas">
                    <img src="legend/BatasAdministrasi_1.png" alt="Batas Administrasi" width="20">
                    Batas Administrasi
                    </label>
                </div>

                <hr style="margin:8px 0;" />
                <h4>Basemaps</h4>
                <div class="legend-item">
                    <input type="radio" name="basemap" id="rdo_carto" checked />
                    <label for="rdo_carto">Carto</label>
                </div>
                <div class="legend-item">
                    <input type="radio" name="basemap" id="rdo_osm" />
                    <label for="rdo_osm">OpenStreetMap</label>
                </div>
                <div class="legend-item">
                    <input type="radio" name="basemap" id="rdo_google" />
                    <label for="rdo_google">Google Satellite</label>
                </div>

            `;
            L.DomEvent.disableClickPropagation(div);
            return div;
        };
        customLegend.addTo(map);
        
        document.getElementById('chk_fotogeotag').addEventListener('change', function(e) {
        if (this.checked) {
            map.addLayer(layer_FotoGeotag_5);
        } else {
            map.removeLayer(layer_FotoGeotag_5);
        }
        });
        document.getElementById('chk_jalan').addEventListener('change', function(e) {
        if (this.checked) {
            map.addLayer(layer_Jalan_4);
        } else {
            map.removeLayer(layer_Jalan_4);
        }
        });
        document.getElementById('chk_blok').addEventListener('change', function(e) {
        if (this.checked) {
            map.addLayer(layer_BlokMojosari_3);
        } else {
            map.removeLayer(layer_BlokMojosari_3);
        }
        });

        document.getElementById('chk_bangunan').addEventListener('change', function(e) {
        if (this.checked) {
            map.addLayer(layer_Bangunan_2);
        } else {
            map.removeLayer(layer_Bangunan_2);
        }
        });

        document.getElementById('chk_batas').addEventListener('change', function(e) {
        if (this.checked) {
            map.addLayer(layer_BatasAdministrasi_1);
        } else {
            map.removeLayer(layer_BatasAdministrasi_1);
        }
        });

        document.getElementById('rdo_carto').addEventListener('change', function() {
            if (this.checked) setBasemap('carto');
        });
        document.getElementById('rdo_osm').addEventListener('change', function() {
            if (this.checked) setBasemap('osm');
        });
        document.getElementById('rdo_google').addEventListener('change', function() {
            if (this.checked) setBasemap('google');
        });
        setBasemap('carto');
        
        
        // var overlaysTree = [
        //     {label: '<img src="legend/FotoGeotag_5.png" /> Foto Geotag', layer: layer_FotoGeotag_5},
        //     {label: '<img src="legend/Jalan_4.png" /> Jalan', layer: layer_Jalan_4},
        //     {label: '<img src="legend/BlokMojosari_3.png" /> Blok Mojosari', layer: layer_BlokMojosari_3},
        //     {label: '<img src="legend/Bangunan_2.png" /> Bangunan', layer: layer_Bangunan_2},
        //     {label: '<img src="legend/BatasAdministrasi_1.png" /> Batas Administrasi', layer: layer_BatasAdministrasi_1},
        //     {label: "CartoDB.PositronNoLabels", layer: layer_CartoDBPositronNoLabels_0},
        //     {label: "OpenStreetMap", layer: layer_OpenStreetMap_1},
        //     {label: "Google Satellite", layer: layer_GoogleSatellite_0},]
        // var lay = L.control.layers.tree(null, overlaysTree,{
        //     //namedToggle: true,
        //     //selectorBack: false,
        //     //closedSymbol: '&#8862; &#x1f5c0;',
        //     //openedSymbol: '&#8863; &#x1f5c1;',
        //     //collapseAll: 'Collapse all',
        //     //expandAll: 'Expand all',
        //     collapsed: false, 

        // var LAYERS_AND_LEGENDS = [
        //   {
        //     title: "Legenda",
        //     layers: [
        //       { title: "Foto Geotag", layer: layer_FotoGeotag_5, legend: '<img src="legend/FotoGeotag_5.png"> Foto Geotag' },
        //       { title: "Jalan", layer: layer_Jalan_4, legend: '<img src="legend/Jalan_4.png"> Jalan' },
        //       { title: "Blok Mojosari", layer: layer_BlokMojosari_3, legend: '<img src="legend/BlokMojosari_3.png"> Blok Mojosari' },
        //       { title: "Bangunan", layer: layer_Bangunan_2, legend: '<img src="legend/Bangunan_2.png"> Bangunan' },
        //       { title: "Batas Administrasi", layer: layer_BatasAdministrasi_1, legend: '<img src="legend/BatasAdministrasi_1.png"> Batas Administrasi' },
        //       { title: "CartoDB.PositronNoLabels", layer: layer_CartoDBPositronNoLabels_0, legend: 'CartoDB.PositronNoLabels' },
        //       { title: "OpenStreetMap", layer: layer_OpenStreetMap_1, legend: 'OpenStreetMap' },
        //       { title: "Google Satellite", layer: layer_GoogleSatellite_0, legend: 'Google Satellite' }
        //     ]
        //   }
        // ];
        // var accordionLegend = new L.Control.AccordionLegend({
        //   legends: LAYERS_AND_LEGENDS,
        //   position: 'topright'
        // });

        // accordionLegend.addTo(map);
		document.addEventListener("DOMContentLoaded", function() {
            // set new Layers List height which considers toggle icon
            function newLayersListHeight() {
                var layerScrollbarElement = document.querySelector('.leaflet-control-layers-scrollbar');
                if (layerScrollbarElement) {
                    var layersListElement = document.querySelector('.leaflet-control-layers-list');
                    var originalHeight = layersListElement.style.height 
                        || window.getComputedStyle(layersListElement).height;
                    var newHeight = parseFloat(originalHeight) - 50;
                    layersListElement.style.height = newHeight + 'px';
                }
            }
            var isLayersListExpanded = true;
            var controlLayersElement = document.querySelector('.leaflet-control-layers');
            var toggleLayerControl = document.querySelector('.leaflet-control-layers-toggle');
            // toggle Collapsed/Expanded and apply new Layers List height
            toggleLayerControl.addEventListener('click', function() {
                if (isLayersListExpanded) {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                } else {
                    controlLayersElement.classList.add('leaflet-control-layers-expanded');
                }
                isLayersListExpanded = !isLayersListExpanded;
                newLayersListHeight()
            });	
			// apply new Layers List height if toggle layerstree
			if (controlLayersElement) {
				controlLayersElement.addEventListener('click', function(event) {
					var toggleLayerHeaderPointer = event.target.closest('.leaflet-layerstree-header-pointer span');
					if (toggleLayerHeaderPointer) {
						newLayersListHeight();
					}
				});
			}
            // Collapsed/Expanded at Start to apply new height
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            setTimeout(function() {
                toggleLayerControl.click();
            }, 10);
            // Collapsed touch/small screen
            var isSmallScreen = window.innerWidth < 650;
            if (isSmallScreen) {
                setTimeout(function() {
                    controlLayersElement.classList.remove('leaflet-control-layers-expanded');
                    isLayersListExpanded = !isLayersListExpanded;
                }, 500);
            }  
        });       
        setBounds();
        var i = 0;
        layer_BatasAdministrasi_1.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['WADMKC'] !== null?String('<div style="color: #323232; font-size: 10pt; font-weight: bold; font-family: \'Helvetica\', sans-serif;">' + layer.feature.properties['WADMKC']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_BatasAdministrasi_1'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        var i = 0;
        layer_BlokMojosari_3.eachLayer(function(layer) {
            var context = {
                feature: layer.feature,
                variables: {}
            };
            layer.bindTooltip((layer.feature.properties['Blok'] !== null?String('<div style="color: #323232; font-size: 5pt; font-family: \'Helvetica\', sans-serif;">' + layer.feature.properties['Blok']) + '</div>':''), {permanent: true, offset: [-0, -16], className: 'css_BlokMojosari_3'});
            labels.push(layer);
            totalMarkers += 1;
              layer.added = true;
              addLabel(layer, i);
              i++;
        });
        resetLabels([layer_BatasAdministrasi_1,layer_BlokMojosari_3]);
        map.on("zoomend", function(){
            resetLabels([layer_BatasAdministrasi_1,layer_BlokMojosari_3]);
        });
        map.on("layeradd", function(){
            resetLabels([layer_BatasAdministrasi_1,layer_BlokMojosari_3]);
        });
        map.on("layerremove", function(){
            resetLabels([layer_BatasAdministrasi_1,layer_BlokMojosari_3]);
        });
        </script>
    </body>
</html>
